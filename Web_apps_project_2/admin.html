<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Firebase Admin</title>
</head>
<body>
<div id="app">
   <h1>User Data</h1>
    <h1 id="usersArea">Users:</h1>
    <ol  v-for="user in users">
        <li>
            <div >
                <h3>User: </h3>
                <p>Access Date: {{user.accessDate}} </p>
                <p>Position: {{user.position}}</p>
                <p>Search Radius: {{user.seachRadius}} Meters</p>
                <p>Searched Terms: {{user.searchedTerms}}</p>
            </div>
        </li>

    </ol>
</div>


<!-- #1 - link to Firebase goes here  -->
<!-- The core Firebase JS SDK is always required and must be listed first -->

<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-database.js"></script>

<!-- Load Vue followed by BootstrapVue -->
<script src="https://unpkg.com/vue@latest/dist/vue.min.js"></script>
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>


<!-- development version, includes helpful console warnings -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="module"></script>
<script>
    
    
    let app = new Vue({
        el: '#app',
        data: {
            users: [],
            uniqueWords: [],
            wordCounts: []
        },
        methods:{
            dataChanged(data){
                let obj = data.val();
                    
                Object.keys(obj).forEach(function (item) {
                app.users.push(obj[item]);
                });
                app.formatUsers();
            },
            firebaseError(error){
                console.log(error);
            },
            formatUsers(){
                // 1- create an array of words from the loaded string
                let bigString;
                for(let i = 0; i < app.users.length; i++){
                    bigString += app.users.searchedTerms;
                }
                let counts = {};
                // 2 - loop through array:

                    for(let w of words){
                        w = w.toLowerCase();
                    //count up frequency of each word and store values in a dictionary (i.e. Object)
                        if(counts[w] == undefined)
                        counts[w] = 1;
                        else
                        counts[w]++;
                    }
                    
                

                // 3 - grab keys of dictionary and sort them by frequency of their "count" in the dictionary
                let keys = Object.keys(counts);

                keys.sort((a, b) =>{
                    let countA = counts[a];
                    let countB = counts[b];

                    return countB - countA;
                });
                // 4 - loop through sorted keys and display frequency of each word on page

                let numElements = 10;
                if(numElements >= keys.length){
                    numElements = keys.length;
                }
                keys = keys.slice(0, numElements);

                for(let k of keys){
                    let p = document.createElement("p")
                    p.innerHTML = `${k} : ${counts[k]}`;
                    keywords.appendChild(p);
                }
            }
        },
        created(){
            /* #2 - The rest of the Firebase setup code goes here */
            var firebaseConfig = {
            apiKey: "AIzaSyDb9VQL79m1DzT7fJtc-OS05yLwUZDP9ME",
            authDomain: "rit-route-finder.firebaseapp.com",
            databaseURL: "https://rit-route-finder.firebaseio.com",
            projectId: "rit-route-finder",
            storageBucket: "rit-route-finder.appspot.com",
            messagingSenderId: "243604851524",
            appId: "1:243604851524:web:be22d86cde7d21cb66e511"
            };
                // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            console.log(firebase); // #3 - make sure firebase is loaded
            
        }
});

firebase.database().ref("users").on("value", app.dataChanged, app.firebaseError);
    

    
</script>

</body>
</html>